<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Doggy Desserts â€“ Monthly Dog Competition</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet" />
  <style>
    body {
      margin: 0;
      background: #fffbe9;
      font-family: 'Poppins', sans-serif;
    }
    header {
      background: #25b3ad;
      color: white;
      padding: 2rem;
      text-align: center;
      font-size: 2rem;
      font-weight: 700;
    }
    .container {
      max-width: 1100px;
      margin: 2rem auto;
      padding: 2rem;
      background: #fff;
      border-radius: 18px;
      box-shadow: 0 2px 12px rgba(0,0,0,0.07);
    }
    .dogs {
      display: flex;
      flex-wrap: wrap;
      gap: 2rem;
      justify-content: center;
    }
    .dog-card {
      width: 280px;
      background: #fcfcfd;
      border-radius: 1rem;
      box-shadow: 0 1px 6px rgba(0,0,0,0.07);
      text-align: center;
      padding: 1.5rem 1rem 2rem 1rem;
      display: flex;
      flex-direction: column;
      align-items: center;
      transition: box-shadow 0.2s;
    }
    .dog-card img {
      width: 100%;
      max-width: 180px;
      height: 160px;
      object-fit: cover;
      border-radius: 12px;
      margin-bottom: 1rem;
      background: #e4e4e4;
    }
    .dog-name {
      font-size: 1.3rem;
      font-weight: 600;
      color: #25b3ad;
      margin-bottom: 0.7rem;
    }
    .votes {
      font-size: 1rem;
      margin-bottom: 1rem;
      color: #333;
    }
    .vote-btn {
      background: #25b3ad;
      color: #fff;
      border: none;
      outline: none;
      border-radius: 2rem;
      padding: 0.5rem 1.4rem;
      font-size: 1.1rem;
      font-weight: 600;
      cursor: pointer;
      margin-bottom: 0.7rem;
      transition: background 0.15s;
    }
    .vote-btn[disabled], .vote-btn:disabled {
      background: #e0e0e0;
      color: #888;
      cursor: not-allowed;
    }
    .share-btn {
      background: #ece8ff;
      color: #554ed6;
      border: none;
      border-radius: 2rem;
      padding: 0.4rem 1rem;
      font-size: 0.97rem;
      cursor: pointer;
      margin-top: 0.2rem;
    }
    .tick {
      margin-right: 5px;
      color: #24ae5f;
    }
  </style>
</head>
<body>
  <header>
    Doggy Desserts<br>
    <span style="font-size:1.1rem; font-weight:400; letter-spacing:0.5px;">Monthly Dog Photo Competition</span>
  </header>

  <div class="container">
    <div class="dogs" id="dogs"></div>
  </div>

  <script>
    // Change these to match your actual Google Sheet CSV & Script URL
    const sheetCSV = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vQBmlL5KZtwZnC7FVy6qUbjIgusWS53DlOaK2pMyDM9f8xuC5_gzzNlYBTt9ncMzK5uxoV1H5KMz8Ap/pub?output=csv';
    const apiURL = 'https://script.google.com/macros/s/AKfycbyqMg0l0LXz9zUwSj1dn2HXG2LmMBAVp_cVAXgXOiXF27qvoLi2UaPJgN3kFZEVppw/exec';

    // Get list of already voted IDs from localStorage
    function getVoted() {
      try {
        return JSON.parse(localStorage.getItem('doggyVotes') || '[]');
      } catch {
        return [];
      }
    }
    function setVoted(voted) {
      localStorage.setItem('doggyVotes', JSON.stringify(voted));
    }

    // Fetch CSV data and render
    fetch(sheetCSV)
      .then(r => r.text())
      .then(csv => {
        const rows = csv.trim().split('\n').slice(1); // Remove header row
        const dogs = rows.map(row => {
          const [id, name, votes, date, img] = row.split(',');
          return { id: id.trim(), name: name.trim(), votes: Number(votes), img: img.trim() };
        });

        const voted = getVoted();
        const dogsDiv = document.getElementById('dogs');
        dogsDiv.innerHTML = '';

        dogs.forEach(dog => {
          const card = document.createElement('div');
          card.className = 'dog-card';

          card.innerHTML = `
            <img src="${dog.img}" alt="${dog.name}" loading="lazy"/>
            <div class="dog-name">${dog.name}</div>
            <div class="votes">Votes: <span id="votes-${dog.id}">${dog.votes}</span></div>
            <button class="vote-btn" id="vote-${dog.id}" ${voted.includes(dog.id) ? 'disabled' : ''}>
              ${voted.includes(dog.id) ? '<span class="tick">&#10003;</span>Voted' : 'Vote'}
            </button>
            <button class="share-btn" onclick="navigator.share ? navigator.share({title: 'Vote for ' + '${dog.name}', url: window.location.href.split('#')[0] + '#dog-'+${dog.id}}) : alert('Copy and share the link to vote!');">Share</button>
          `;

          // Vote button logic
          card.querySelector('.vote-btn').onclick = function() {
            this.disabled = true;
            this.innerHTML = '<span class="tick">&#10003;</span>Voted';
            fetch(apiURL, {
              method: 'POST',
              headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
              body: 'id=' + encodeURIComponent(dog.id)
            })
              .then(r => r.json())
              .then(res => {
                if (res.success) {
                  document.getElementById('votes-' + dog.id).textContent = res.newVotes;
                  const newVoted = getVoted();
                  newVoted.push(dog.id);
                  setVoted(newVoted);
                } else {
                  alert('Sorry, vote failed. Try again?');
                  this.disabled = false;
                  this.innerHTML = 'Vote';
                }
              })
              .catch(() => {
                alert('Sorry, could not connect. Try again?');
                this.disabled = false;
                this.innerHTML = 'Vote';
              });
          };

          // Set anchor for sharing
          card.id = 'dog-' + dog.id;

          dogsDiv.appendChild(card);
        });
      });
  </script>
</body>
</html>

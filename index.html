<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Doggy Desserts - Monthly Dog Voting</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@600;700&display=swap" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body { background: #fef9f2; font-family: 'Poppins', sans-serif; }
    .vote-pill {
      transition: background 0.2s, color 0.2s;
      background: #ffe4ef;
      color: #e64880;
      font-weight: 600;
    }
    .vote-pill.voted {
      background: #fdcfe4 !important;
      color: #e64880 !important;
      pointer-events: none;
    }
    .vote-heart {
      width: 1.7em;
      height: 1.7em;
      vertical-align: middle;
      margin-right: 0.45em;
      transition: fill 0.2s;
      fill: #ff92c4;
      flex-shrink: 0;
      display: inline;
    }
    .vote-pill.voted .vote-heart { fill: #e64880; }
    .share-btn {
      transition: background 0.17s;
    }
    .share-btn:active {
      background: #c7e2ff !important;
    }
    .copied-tip {
      font-size: 0.98rem;
      margin-top: 2px;
      color: #63b7e8;
      opacity: 0;
      transition: opacity 0.18s;
      pointer-events: none;
      position: absolute;
      right: 7px;
      bottom: 9px;
      z-index: 5;
    }
    .copied-tip.show { opacity: 1; }
    .thankyou-msg {
      color: #25b3ad;
      font-weight: 600;
      font-size: 1.12rem;
      margin-top: 13px;
      margin-bottom: 7px;
      text-align: center;
      opacity: 0;
      transition: opacity 0.3s;
    }
    .thankyou-msg.show { opacity: 1; }
    .card-shadow { box-shadow: 0 4px 26px 0 rgba(80, 86, 119, 0.11);}
    .card-bg { background: #fff; }
    .bg-dog { background: #e6e8ec;}
    .rounded-xl-2 { border-radius: 28px;}
    .overflow-hidden {overflow: hidden;}
    .dog-img { object-fit: cover; border-radius: 50%; width: 8.5rem; height: 8.5rem; background: #f2f2f2;}
    @media (max-width:900px) {
      .w-card { width: 98vw !important; min-width: 280px !important;}
    }
  </style>
</head>
<body>
  <div class="w-full bg-[#25b3ad] pb-2 pt-8">
    <div class="max-w-3xl mx-auto px-3 text-center">
      <h1 class="text-white font-bold text-4xl md:text-5xl mb-1" style="letter-spacing:0.04em;">Doggy Desserts</h1>
      <div class="text-white font-semibold text-xl mb-2">Monthly Dog Photo Competition</div>
      <div class="rounded-xl py-2 bg-[#fef6e0] text-[#1bb3a8] font-bold text-lg mb-1 max-w-xl mx-auto shadow" style="letter-spacing:0.01em;">
        Which dog will win a Doggy Desserts cake? Vote now!
      </div>
      <div class="text-white text-md font-normal mt-1 mb-1">
        Vote for your favourite doggy. Each person can vote once per dog.
      </div>
    </div>
  </div>
  <div class="w-full min-h-screen flex flex-col justify-center items-center px-2 py-7">
    <div id="dog-cards" class="flex flex-wrap justify-center gap-8 w-full max-w-6xl"></div>
  </div>
  <script>
    // CONFIG
    const sheetURL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vQBmlL5KZtwZnC7FVy6qUbjIgusWS53DIoAK2pMyDM9f8xuC5_gzzNlYBTt9ncMzK5uxoV1H5KMz8Ap/pub?output=csv';
    const voteAPI = 'https://script.google.com/macros/s/AKfycbyqMg0l0LXz9zUwSj1dn2HXG2LmMBAVp_cVAXgXOiXF27qvoLi2UaPJgN3kFZEVppw/exec';
    const votedKey = "doggyVotes_July2025";
    // UTILS
    function getVoted() {
      try { return JSON.parse(localStorage.getItem(votedKey) || "[]"); } catch { return []; }
    }
    function setVoted(list) {
      localStorage.setItem(votedKey, JSON.stringify(list));
    }
    // Fetch and render dogs
    function fetchDogs() {
      return fetch(sheetURL)
        .then(r => r.text())
        .then(csv => {
          let rows = csv.trim().split("\n").slice(1);
          return rows.map(row => {
            let [id, name, votes, , img] = row.split(",");
            return { id: id.trim(), name: name.trim(), votes: Number(votes||0), img: img?img.trim():"" };
          });
        });
    }
    function renderDogs(dogs) {
      const voted = getVoted();
      const cards = document.getElementById('dog-cards');
      cards.innerHTML = '';
      dogs.forEach(dog => {
        const votedFor = voted.includes(dog.id);
        // Card
        const card = document.createElement('div');
        card.className = "bg-white card-shadow rounded-xl-2 overflow-hidden flex flex-col w-[340px] w-card mb-2";
        // IMG BG
        card.innerHTML = `
          <div class="bg-dog flex justify-center items-center" style="height:220px;">
            <img src="${dog.img}" alt="${dog.name}" class="dog-img mt-7 mb-3" />
          </div>
          <div class="p-7 pt-5 flex-1 flex flex-col justify-end relative">
            <div class="font-bold text-2xl text-[#24262f] mb-2 uppercase tracking-tight">${dog.name}</div>
            <div class="flex flex-row items-center gap-3 mt-2">
              <button class="vote-pill flex items-center px-6 py-2 rounded-full focus:outline-none text-lg select-none relative ${votedFor?'voted':''}" style="${votedFor?'pointer-events:none;':''}" data-id="${dog.id}">
                <svg class="vote-heart" viewBox="0 0 24 24">
                  <path d="M12 21s-5.7-5-8-7.6C-0.4 9.9 2 5.5 6.5 5.5c1.7 0 3.3 0.8 4.2 2.1C11.2 6.3 12.8 5.5 14.5 5.5 19 5.5 21.4 9.9 20 13.4c-2.3 2.6-8 7.6-8 7.6z"/>
                </svg>
                <span><span class="votes">${dog.votes}</span> Votes</span>
              </button>
              <button class="share-btn bg-[#e9f4ff] p-3 rounded-full ml-auto relative" title="Share" data-name="${encodeURIComponent(dog.name)}">
                <svg fill="#63b7e8" height="22" viewBox="0 0 24 24" width="22">
                  <path d="M13 5v7h-1.5V6.7L5.8 12.5l1.1 1.1 6.5-6.5V12H13V5zm-2 12.5c0 .8-.7 1.5-1.5 1.5s-1.5-.7-1.5-1.5S8.7 16 9.5 16s1.5.7 1.5 1.5zm9-7.5V3H3v18h18V10h-2z"/>
                </svg>
                <div class="copied-tip">Link copied!</div>
              </button>
            </div>
            <div class="thankyou-msg">Thank you for voting!</div>
          </div>
        `;
        // Vote click
        const voteBtn = card.querySelector('.vote-pill');
        if(!votedFor) {
          voteBtn.onclick = function() {
            if (voteBtn.classList.contains('voted')) return;
            voteBtn.classList.add('voted');
            voteBtn.querySelector('.vote-heart').style.fill = '#e64880';
            // Count up visually
            const span = voteBtn.querySelector('.votes');
            span.textContent = Number(span.textContent)+1;
            // Store in localStorage
            const votedList = getVoted();
            votedList.push(dog.id);
            setVoted(votedList);
            // Thank you!
            const thankYou = card.querySelector('.thankyou-msg');
            thankYou.classList.add('show');
            setTimeout(()=>thankYou.classList.remove('show'), 1800);
            // POST to script
            fetch(voteAPI, {
              method: 'POST',
              headers: {'Content-Type':'application/x-www-form-urlencoded'},
              body: 'id='+encodeURIComponent(dog.id)
            });
            voteBtn.disabled = true;
          };
        }
        // Share click
        const shareBtn = card.querySelector('.share-btn');
        shareBtn.onclick = function() {
          const url = window.location.origin + window.location.pathname + '#' + dog.id;
          navigator.clipboard.writeText(url);
          const tip = shareBtn.querySelector('.copied-tip');
          tip.classList.add('show');
          setTimeout(()=>tip.classList.remove('show'), 1200);
        };
        cards.appendChild(card);
      });
    }
    // Load and render
    document.addEventListener('DOMContentLoaded',()=>{
      fetchDogs().then(renderDogs);
    });
  </script>
</body>
</html>

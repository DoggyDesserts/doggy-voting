<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Doggy Desserts Voting</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@600;700&display=swap" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body {
      background: #fef9f2;
      font-family: 'Poppins', sans-serif;
    }
    .vote-pill {
      transition: background 0.2s, color 0.2s;
      min-width: 130px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .vote-pill.voted {
      background: #fdcfe4 !important;
      color: #e64880 !important;
    }
    .vote-heart {
      width: 1.5em;
      height: 1.5em;
      vertical-align: middle;
      margin-right: 0.45em;
      fill: #e64880;
      flex-shrink: 0;
      transition: fill 0.2s;
    }
    .vote-pill:not(.voted) .vote-heart {
      fill: #ff92c4;
    }
    .share-btn {
      transition: background 0.17s, color 0.17s;
      font-weight: 600;
    }
    .share-btn:active {
      background: #c7e2ff !important;
    }
    .copied-tip {
      font-size: 0.98rem;
      margin-top: 3px;
      color: #63b7e8;
      opacity: 0;
      transition: opacity 0.18s;
      pointer-events: none;
      position: absolute;
      right: 6px;
      bottom: 8px;
    }
    .copied-tip.show {
      opacity: 1;
    }
    .dog-img {
      width: 100%;
      height: 170px;
      border-radius: 1.25rem;
      object-fit: cover;
      background: #e6e8ec;
      display: block;
    }
    @media (max-width: 900px) {
      .dog-img { height: 140px; }
    }
    @media (max-width: 600px) {
      .dog-img { height: 120px; }
    }
  </style>
</head>
<body>
  <div class="min-h-screen flex flex-col items-center px-2 py-6">
    <div class="w-full max-w-3xl mx-auto text-center mb-2">
      <h1 class="text-4xl font-bold text-[#22b0ad] mb-1" style="letter-spacing:0.03em;">Doggy Desserts</h1>
      <div class="text-xl font-semibold text-[#186f7c] mb-2">Monthly Dog Photo Competition</div>
      <div class="font-semibold text-[#179d90] bg-[#fff6e3] rounded-lg inline-block py-2 px-5 mb-2">Which dog will win a Doggy Desserts cake? Vote now!</div>
      <div class="text-base mt-1 font-normal text-[#24786c]">Vote for your favourite doggy. Each person can vote once per dog.</div>
    </div>
    <div id="dogs" class="flex flex-wrap justify-center gap-8 w-full max-w-6xl mt-3"></div>
  </div>

  <script>
    // Your published CSV (update if yours ever changes)
    const sheetCSV = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vQBmlL5KZtwZnC7FVy6qUbjIgusWS53DIoAK2pMyDM9f8xuC5_gzzNlYBTt9ncMzK5uxoV1H5KMz8Ap/pub?output=csv';
    const votedKey = 'doggyVotesJuly2025';

    function fetchDogs() {
      return fetch(sheetCSV)
        .then(r => r.text())
        .then(csv => {
          const rows = csv.trim().split('\n').slice(1);
          return rows.map(row => {
            // ["1","SHADOW","2","2025-07-17","https://..."]
            const [id, name, votes, date, img] = row.split(',');
            return {
              id: id.trim(),
              name: name.trim(),
              votes: Number(votes),
              img: img ? img.trim() : ''
            };
          });
        });
    }

    function renderDogs(dogs) {
      const voted = JSON.parse(localStorage.getItem(votedKey) || '[]');
      const dogsDiv = document.getElementById('dogs');
      dogsDiv.innerHTML = '';
      dogs.forEach((dog, idx) => {
        // Build card
        const card = document.createElement('div');
        card.className = 'bg-white rounded-3xl shadow-xl overflow-hidden flex flex-col w-[320px] mb-2';

        // Card image with fallback if image fails to load
        card.innerHTML = `
          <div class="flex justify-center items-center px-4 pt-6" style="height:185px;">
            <img 
              src="${dog.img}" 
              alt="${dog.name}" 
              class="dog-img"
              onerror="this.onerror=null;this.src='https://svgshare.com/i/13Lf.svg';"
            />
          </div>
          <div class="p-7 pt-5 flex-1 flex flex-col justify-end relative">
            <div class="font-bold text-2xl text-[#24262f] mb-3">${dog.name}</div>
            <div class="flex flex-row items-center gap-3 mt-1">
              <button class="vote-pill flex items-center px-5 py-2 rounded-full font-semibold bg-[#ffe4ef] text-[#e64880] focus:outline-none active:scale-95 text-lg select-none" data-id="${dog.id}">
                <svg class="vote-heart" viewBox="0 0 24 24">
                  <path d="M12 21c-.3 0-.6-.1-.8-.3C8.5 18.5 3 13.7 3 9.7 3 7.1 5.2 5 7.8 5c1.1 0 2.1.5 2.9 1.2C11.9 5.5 12.9 5 14 5c2.6 0 4.8 2.1 4.8 4.7 0 4-5.5 8.8-8.2 11.1-.2.2-.5.2-.8.2z"/>
                </svg>
                <span><span class="votes">${dog.votes}</span> Votes</span>
              </button>
              <button class="share-btn bg-[#e9f4ff] px-5 py-2 rounded-full flex items-center text-[#2295ff]" title="Share">
                <span>Share</span>
                <svg width="18" height="18" fill="#2295ff" viewBox="0 0 20 20" class="ml-1"><path d="M9.293 15.707a1 1 0 0 1 0-1.414L12.586 11H5a1 1 0 1 1 0-2h7.586l-3.293-3.293a1 1 0 0 1 1.414-1.414l5 5a1 1 0 0 1 0 1.414l-5 5a1 1 0 0 1-1.414 0z"/></svg>
              </button>
            </div>
          </div>
        `;

        // Voting logic
        const voteBtn = card.querySelector('.vote-pill');
        if (voted.includes(dog.id)) {
          voteBtn.classList.add('voted');
          voteBtn.disabled = true;
        }
        voteBtn.onclick = function () {
          if (voteBtn.classList.contains('voted')) return;
          voteBtn.classList.add('voted');
          voteBtn.disabled = true;
          let n = parseInt(voteBtn.querySelector('.votes').textContent) || 0;
          voteBtn.querySelector('.votes').textContent = n + 1;
          voted.push(dog.id);
          localStorage.setItem(votedKey, JSON.stringify(voted));
          // Optionally: POST to backend/API here
        };

        // Share logic
        const shareBtn = card.querySelector('.share-btn');
        shareBtn.onclick = function () {
          const url = window.location.origin + window.location.pathname + "#" + encodeURIComponent(dog.name);
          navigator.clipboard.writeText(url);
          shareBtn.querySelector('span').textContent = 'Copied!';
          setTimeout(() => shareBtn.querySelector('span').textContent = 'Share', 1300);
        };

        dogsDiv.appendChild(card);
      });
    }

    document.addEventListener('DOMContentLoaded', function () {
      fetchDogs().then(renderDogs);
    });
  </script>
</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Doggy Desserts Voting</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@600;700&display=swap" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body {
      background: #fef9f2;
      font-family: 'Poppins', sans-serif;
    }
    .dog-card {
      background: #fff;
      border-radius: 1.5rem;
      box-shadow: 0 4px 28px rgba(60, 70, 130, 0.12);
      overflow: hidden;
      width: 310px;
      min-width: 280px;
      margin-bottom: 1.5rem;
      transition: box-shadow 0.19s;
    }
    .dog-img-wrap {
      background: #e6e8ec;
      padding: 32px 0 0 0;
      display: flex;
      justify-content: center;
      align-items: flex-start;
      height: 210px;
    }
    .dog-img {
      width: 140px;
      height: 140px;
      object-fit: cover;
      border-radius: 18px;
      box-shadow: 0 2px 9px #e2e2e2;
    }
    .dog-name {
      font-size: 1.44rem;
      font-weight: 700;
      letter-spacing: 0.01em;
      color: #24262f;
      margin: 0 0 0.7rem 0;
      text-align: left;
      margin-left: 1.6rem;
      margin-top: 1.3rem;
    }
    .dog-card-footer {
      padding: 0 1.6rem 1.3rem 1.6rem;
      display: flex;
      align-items: centre;
      gap: 0.8rem;
    }
    .vote-pill {
      display: flex;
      align-items: center;
      background: #ffe3ef;
      color: #e64880;
      border: none;
      border-radius: 2rem;
      padding: 0.8rem 1.3rem 0.8rem 1.3rem;
      font-size: 1.18rem;
      font-weight: 600;
      cursor: pointer;
      transition: background 0.16s, color 0.16s;
      box-shadow: 0 2px 8px #fcd7e8;
      gap: 0.5rem;
      min-width: 115px;
      justify-content: center;
    }
    .vote-pill.voted {
      background: #fdcfe4;
      color: #e64880;
      cursor: not-allowed;
      opacity: 0.92;
    }
    .vote-heart {
      width: 1.5em;
      height: 1.5em;
      fill: #e64880;
      display: inline-block;
      margin-right: 0.28em;
      margin-bottom: 0.07em;
      vertical-align: middle;
    }
    .share-btn {
      display: flex;
      align-items: center;
      background: #e9f4ff;
      color: #41a4ff;
      font-weight: 600;
      border: none;
      border-radius: 2rem;
      padding: 0.8rem 1.2rem;
      font-size: 1.13rem;
      cursor: pointer;
      transition: background 0.13s, color 0.14s;
      box-shadow: 0 2px 7px #c9e6fd;
      gap: 0.5rem;
    }
    .share-arrow {
      margin-left: 0.35em;
      width: 1.1em;
      height: 1.1em;
      display: inline-block;
      stroke: #41a4ff;
      stroke-width: 2.2;
    }
    .copied-tip {
      font-size: 0.97rem;
      color: #41a4ff;
      opacity: 0;
      margin-left: 0.4rem;
      transition: opacity 0.18s;
      pointer-events: none;
      position: absolute;
      bottom: 14px;
      right: 34px;
    }
    .copied-tip.show {
      opacity: 1;
    }
    @media (max-width: 980px) {
      .dog-card { width: 94vw; min-width: 240px; }
      .dog-card-footer { flex-direction: column; align-items: flex-start; gap: 0.55rem; }
      .dog-name { margin-left: 0.5rem;}
    }
  </style>
</head>
<body>
  <div class="min-h-screen flex flex-col justify-center items-center px-2 py-6">
    <h1 class="text-4xl font-bold text-white bg-[#25b3ad] py-7 w-full text-center mb-2" style="letter-spacing:0.04em;">Doggy Desserts<br>
      <span class="text-xl font-semibold block mt-2">Monthly Dog Photo Competition</span>
    </h1>
    <div class="text-center mb-3">
      <div class="bg-[#fff9ea] text-[#25b3ad] rounded-xl px-4 py-2 font-bold text-lg inline-block mb-2">Which dog will win a Doggy Desserts cake? Vote now!</div>
      <div class="text-[#25b3ad] text-base">Vote for your favourite doggy. Each person can vote once per dog.</div>
    </div>
    <div class="flex flex-wrap justify-center gap-8 w-full max-w-6xl mt-2">
      <!-- Dog Cards Rendered Here -->
    </div>
  </div>

  <script>
    // Your Google Sheet CSV link
    const sheetCSV = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vQBmlL5KZtwZnC7FVy6qUbjIgusWS53DIoAK2pMyDM9f8xuC5_gzzNlYBTt9ncMzK5uxoV1H5KMz8Ap/pub?output=csv';
    const apiURL = 'https://script.google.com/macros/s/AKfycbyqMg0l0LXz9zUwSj1dn2HXG2LmMBAVp_cVAXgXOiXF27qvoLi2UaPJgN3kFZEVppw/exec';
    const votedKey = 'voted_July_2025_';

    function fetchDogs() {
      return fetch(sheetCSV)
        .then(r => r.text())
        .then(csv => {
          const rows = csv.trim().split('\n').slice(1);
          return rows.map(row => {
            const [id, name, votes, date, img] = row.split(',');
            return {
              id: id.trim(),
              name: name.trim(),
              votes: Number(votes),
              img: img ? img.trim() : ''
            };
          });
        });
    }

    function renderDogs(dogs) {
      const voted = JSON.parse(localStorage.getItem('doggyVotes') || '[]');
      const wrapper = document.querySelector('.flex.flex-wrap');
      wrapper.innerHTML = '';
      dogs.forEach(dog => {
        const votedForThis = voted.includes(dog.id);
        const card = document.createElement('div');
        card.className = 'dog-card';

        card.innerHTML = `
          <div class="dog-img-wrap">
            <img class="dog-img" src="${dog.img}" alt="${dog.name}" onerror="this.src='https://cdn-icons-png.flaticon.com/512/616/616408.png';"/>
          </div>
          <div class="dog-name">${dog.name}</div>
          <div class="dog-card-footer">
            <button class="vote-pill${votedForThis ? ' voted' : ''}" ${votedForThis ? 'disabled' : ''} data-id="${dog.id}">
              <svg class="vote-heart" viewBox="0 0 24 24"><path d="M12 21c-.3 0-.7-.1-1-.4-1.4-1.1-2.8-2.2-4-3.4C3.2 15.3 2 13.3 2 11.3 2 8.7 4.2 6.5 6.8 6.5c1.1 0 2.2.4 3 1.1.8-.7 1.9-1.1 3-1.1C19.8 6.5 22 8.7 22 11.3c0 2-1.2 4-5 6.9-1.2 1.2-2.6 2.3-4 3.4-.3.3-.7.4-1 .4z"/></svg>
              <span><span class="votes">${dog.votes}</span> Votes</span>
            </button>
            <button class="share-btn" title="Share" onclick="copyShare(this)">
              Share
              <svg class="share-arrow" viewBox="0 0 24 24" fill="none"><path d="M5 12h14m0 0l-6-6m6 6l-6 6" stroke-linecap="round" stroke-linejoin="round"/></svg>
            </button>
            <div class="copied-tip">Link copied!</div>
          </div>
        `;

        // Vote logic
        card.querySelector('.vote-pill').onclick = function() {
          if (votedForThis) return;
          this.classList.add('voted');
          this.disabled = true;
          let vSpan = this.querySelector('.votes');
          vSpan.textContent = parseInt(vSpan.textContent) + 1;
          voted.push(dog.id);
          localStorage.setItem('doggyVotes', JSON.stringify(voted));
          // POST to API
          fetch(apiURL, {
            method: 'POST',
            headers: {'Content-Type':'application/x-www-form-urlencoded'},
            body: 'id=' + encodeURIComponent(dog.id)
          });
        };

        // Share feedback
        card.querySelector('.share-btn').onclick = function() {
          const url = window.location.origin + window.location.pathname + "#dog-" + encodeURIComponent(dog.id);
          navigator.clipboard.writeText(url);
          const tip = card.querySelector('.copied-tip');
          tip.classList.add('show');
          setTimeout(() => tip.classList.remove('show'), 1200);
        };

        card.id = 'dog-' + dog.id;
        wrapper.appendChild(card);
      });
    }

    document.addEventListener('DOMContentLoaded', function() {
      fetchDogs().then(renderDogs);
    });
  </script>
</body>
</html>
